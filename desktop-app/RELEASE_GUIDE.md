# Release Guide - Creating GitHub Releases for Auto-Update

This guide shows you how to build and release the desktop app to GitHub Releases so the auto-update feature works.

## üìã Prerequisites

- Node.js installed (v16 or higher)
- Git installed
- GitHub account with access to the repository
- All code changes committed and pushed

## üèóÔ∏è Step 1: Build the Desktop App

### On Your Local Machine:

```bash
cd desktop-app
npm install
npm run build:all
```

This will create installers in `desktop-app/dist/`:
- **Mac**: `AntifaTimes-Stream-Manager-1.0.0.dmg` and `.zip`
- **Windows**: `AntifaTimes-Stream-Manager-Setup-1.0.0.exe`
- **Linux**: `AntifaTimes-Stream-Manager-1.0.0.AppImage` and `.deb`

**Note**: Building for all platforms may have limitations:
- On Mac: Can build Mac + Linux (not Windows)
- On Windows: Can only build Windows
- On Linux: Can build Linux (not Mac/Windows)

For cross-platform builds, use GitHub Actions (see Advanced section).

## üì¶ Step 2: Create GitHub Release

### Option A: Using GitHub Web Interface

1. **Go to Releases Page**
   - Navigate to: https://github.com/chalkyjason/UniteRev/releases
   - Click **"Draft a new release"**

2. **Create Tag**
   - Click "Choose a tag"
   - Type: `v1.0.0`
   - Click "Create new tag: v1.0.0 on publish"

3. **Fill Release Info**
   - **Release title**: `v1.0.0 - Initial Release`
   - **Description**:
   ```markdown
   ## üéâ AntifaTimes Stream Manager v1.0.0

   Multi-platform live protest discovery engine with customizable control panel.

   ### ‚ú® Features
   - Drag-and-drop stream management
   - Customizable panel layout with resize and reposition
   - Color themes and custom branding
   - Unified chat for Twitch/YouTube
   - Multi-grid layouts
   - Desktop app with auto-update support

   ### üì• Installation

   **macOS**:
   1. Download `AntifaTimes-Stream-Manager-1.0.0.dmg`
   2. Open and drag to Applications
   3. Right-click ‚Üí Open (first time only)

   **Windows**:
   1. Download `AntifaTimes-Stream-Manager-Setup-1.0.0.exe`
   2. Run installer
   3. Click "More info" ‚Üí "Run anyway" if SmartScreen appears

   **Linux**:
   1. Download `AntifaTimes-Stream-Manager-1.0.0.AppImage`
   2. Make executable: `chmod +x AntifaTimes-Stream-Manager-1.0.0.AppImage`
   3. Run: `./AntifaTimes-Stream-Manager-1.0.0.AppImage`

   ### üîÑ Auto-Update
   The app checks for updates on startup and prompts to download new versions.
   ```

4. **Upload Build Files**
   - Drag and drop files from `desktop-app/dist/`:
     - `AntifaTimes-Stream-Manager-1.0.0.dmg`
     - `AntifaTimes-Stream-Manager-1.0.0.zip` (for Mac auto-update)
     - `AntifaTimes-Stream-Manager-Setup-1.0.0.exe`
     - `AntifaTimes-Stream-Manager-1.0.0.AppImage`
     - `latest-mac.yml` (auto-generated by build)
     - `latest-linux.yml` (auto-generated by build)
     - `latest.yml` (for Windows, auto-generated by build)

   **IMPORTANT**: You must upload the `.yml` files for auto-update to work!

5. **Publish Release**
   - Check "Set as the latest release"
   - Click **"Publish release"**

### Option B: Using GitHub CLI

```bash
# Install GitHub CLI if you don't have it
# macOS: brew install gh
# Windows: https://cli.github.com/
# Linux: https://github.com/cli/cli/blob/trunk/docs/install_linux.md

# Authenticate
gh auth login

# Create release and upload files
cd desktop-app
gh release create v1.0.0 \
  --title "v1.0.0 - Initial Release" \
  --notes "Multi-platform live protest discovery engine. See https://github.com/chalkyjason/UniteRev for full details." \
  dist/*.dmg \
  dist/*.zip \
  dist/*.exe \
  dist/*.AppImage \
  dist/*.yml
```

## üîÑ Step 3: Test Auto-Update

1. **Install the app** from the release you just created

2. **Make a small change** to your code:
   ```bash
   # Update version in package.json
   "version": "1.0.1"
   ```

3. **Build again**:
   ```bash
   npm run build:all
   ```

4. **Create new release** (v1.0.1) following Step 2

5. **Open the old version** (v1.0.0) of your app
   - It should detect the new version
   - Prompt you to download and install v1.0.1
   - After download, restart to apply update

## üìù Version Numbering

Use [Semantic Versioning](https://semver.org/):
- **Major** (1.x.x): Breaking changes
- **Minor** (x.1.x): New features, backwards compatible
- **Patch** (x.x.1): Bug fixes

Examples:
- `1.0.0` ‚Üí `1.0.1` (bug fix)
- `1.0.1` ‚Üí `1.1.0` (new feature)
- `1.1.0` ‚Üí `2.0.0` (breaking change)

## üöÄ Advanced: Automated Builds with GitHub Actions

### Create `.github/workflows/build.yml`:

```yaml
name: Build and Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [macos-latest, windows-latest, ubuntu-latest]

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: |
          cd desktop-app
          npm install

      - name: Build
        run: |
          cd desktop-app
          npm run build
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: ${{ matrix.os }}-build
          path: desktop-app/dist/*

      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: desktop-app/dist/*
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### To use:
```bash
# Tag your commit
git tag v1.0.0
git push origin v1.0.0

# GitHub Actions will automatically:
# 1. Build for Mac, Windows, Linux
# 2. Create a GitHub release
# 3. Upload all files
```

## üêõ Troubleshooting

### Auto-update not working?
- **Check .yml files uploaded**: `latest-mac.yml`, `latest-linux.yml`, `latest.yml`
- **Check repository URL** in `package.json` matches your GitHub repo
- **Check version** in `package.json` is higher than installed version
- **Check console** for errors (Help ‚Üí Toggle Developer Tools)

### Build fails?
- **Clear cache**: `rm -rf node_modules package-lock.json && npm install`
- **Update electron-builder**: `npm install electron-builder@latest --save-dev`
- **Check Node version**: `node -v` (should be 16+)

### Can't build for other platforms?
- Use GitHub Actions (see Advanced section)
- Or build on each platform separately
- Or use a CI service (CircleCI, Travis CI)

## üìö Resources

- [electron-builder docs](https://www.electron.build/)
- [electron-updater docs](https://www.electron.build/auto-update)
- [GitHub Releases](https://docs.github.com/en/repositories/releasing-projects-on-github)
- [Semantic Versioning](https://semver.org/)

## ‚úÖ Checklist for Each Release

- [ ] Update version in `package.json`
- [ ] Update CHANGELOG.md with changes
- [ ] Commit and push all changes
- [ ] Build for all platforms
- [ ] Create GitHub release with proper tag (v1.x.x)
- [ ] Upload all build files (.dmg, .exe, .AppImage)
- [ ] Upload all .yml files (critical for auto-update!)
- [ ] Write clear release notes
- [ ] Test installation on each platform
- [ ] Test auto-update from previous version
