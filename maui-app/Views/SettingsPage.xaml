<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:UniteRev.Maui.ViewModels"
             xmlns:models="clr-namespace:UniteRev.Maui.Models"
             x:Class="UniteRev.Maui.Views.SettingsPage"
             x:DataType="vm:SettingsViewModel"
             Title="Settings"
             BackgroundColor="{StaticResource BackgroundDark}">

    <ScrollView>
        <VerticalStackLayout Padding="24" Spacing="16" MaximumWidthRequest="800">

            <Label Text="âš™ï¸ Settings" Style="{StaticResource Title}"/>

            <!-- General Settings -->
            <Frame Style="{StaticResource Card}">
                <VerticalStackLayout Spacing="16">
                    <Label Text="General" Style="{StaticResource SectionHeader}"/>

                    <!-- Grid Layout -->
                    <Grid ColumnDefinitions="*,200">
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="Default Grid Layout" Style="{StaticResource Body}" FontAttributes="Bold"/>
                            <Label Text="Choose the default stream grid arrangement" Style="{StaticResource Caption}"/>
                        </VerticalStackLayout>
                        <Picker Grid.Column="1"
                                ItemsSource="{Binding LayoutOptions}"
                                SelectedItem="{Binding GridLayout}"
                                TextColor="{StaticResource TextPrimary}"
                                TitleColor="{StaticResource TextSecondary}"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Platform Connections -->
            <Frame Style="{StaticResource Card}">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Platform Connections" Style="{StaticResource SectionHeader}"/>

                    <!-- Twitch Status -->
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Label Text="ðŸŸ£" FontSize="24" VerticalOptions="Center"/>
                        <VerticalStackLayout Grid.Column="1" Margin="12,0" VerticalOptions="Center">
                            <Label Text="Twitch" Style="{StaticResource Body}" FontAttributes="Bold"/>
                            <Label Style="{StaticResource Caption}"
                                   TextColor="{Binding TwitchConnected, Converter={StaticResource BoolToConnectionStatusConverter}}"
                                   Text="{Binding TwitchConnected, Converter={StaticResource BoolToConnectionStatusConverter}}"/>
                        </VerticalStackLayout>
                        <Frame Grid.Column="2"
                               BackgroundColor="{Binding TwitchConnected, Converter={StaticResource BoolToStatusColorConverter}}"
                               CornerRadius="12" Padding="12,6" HasShadow="False" VerticalOptions="Center">
                            <Label Text="{Binding TwitchConnected, Converter={StaticResource BoolToConnectionStatusConverter}}"
                                   TextColor="White" FontSize="12"/>
                        </Frame>
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource BorderDark}"/>

                    <!-- YouTube Status -->
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Label Text="ðŸ”´" FontSize="24" VerticalOptions="Center"/>
                        <VerticalStackLayout Grid.Column="1" Margin="12,0" VerticalOptions="Center">
                            <Label Text="YouTube" Style="{StaticResource Body}" FontAttributes="Bold"/>
                            <Label Style="{StaticResource Caption}"
                                   Text="{Binding YouTubeConnected, Converter={StaticResource BoolToConnectionStatusConverter}}"/>
                        </VerticalStackLayout>
                        <Frame Grid.Column="2"
                               BackgroundColor="{Binding YouTubeConnected, Converter={StaticResource BoolToStatusColorConverter}}"
                               CornerRadius="12" Padding="12,6" HasShadow="False" VerticalOptions="Center">
                            <Label Text="{Binding YouTubeConnected, Converter={StaticResource BoolToConnectionStatusConverter}}"
                                   TextColor="White" FontSize="12"/>
                        </Frame>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Saved Streamers Management -->
            <Frame Style="{StaticResource Card}">
                <VerticalStackLayout Spacing="12">
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Text="Saved Streamers" Style="{StaticResource SectionHeader}"/>
                        <Label Grid.Column="1"
                               Text="{Binding SavedStreamersCount, StringFormat='{0} saved'}"
                               Style="{StaticResource Caption}" VerticalOptions="Center"/>
                    </Grid>

                    <!-- Import/Export -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                        <Button Text="ðŸ“‹ Export to Clipboard"
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding ExportStreamersCommand}"/>
                        <Button Grid.Column="1" Text="ðŸ“¥ Import from Clipboard"
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding ImportStreamersCommand}"/>
                    </Grid>

                    <!-- Streamer List -->
                    <CollectionView ItemsSource="{Binding SavedStreamers}"
                                    MaximumHeightRequest="400">
                        <CollectionView.EmptyView>
                            <Label Text="No saved streamers" Style="{StaticResource Caption}"
                                   Margin="0,8"/>
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Streamer">
                                <Grid ColumnDefinitions="Auto,*,Auto"
                                      Padding="8,6" ColumnSpacing="8">
                                    <Label Text="{Binding PlatformIcon}"
                                           FontSize="20" VerticalOptions="Center"/>
                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                        <Label Text="{Binding DisplayName}"
                                               Style="{StaticResource Body}"
                                               LineBreakMode="TailTruncation"/>
                                        <Label Style="{StaticResource Caption}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding Platform}"/>
                                                    <Span Text=" Â· "/>
                                                    <Span Text="{Binding Handle}"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </VerticalStackLayout>
                                    <Button Grid.Column="2" Text="ðŸ—‘"
                                            Style="{StaticResource IconButton}"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SettingsViewModel}}, Path=DeleteStreamerCommand}"
                                            CommandParameter="{Binding .}"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Data Management -->
            <Frame Style="{StaticResource Card}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Data Management" Style="{StaticResource SectionHeader}"/>

                    <Button Text="ðŸ—‘ Clear All Data"
                            Style="{StaticResource DangerButton}"
                            Command="{Binding ClearAllDataCommand}"/>
                    <Label Text="This will delete all saved streamers, settings, and API credentials"
                           Style="{StaticResource Caption}"/>
                </VerticalStackLayout>
            </Frame>

            <!-- About -->
            <Frame Style="{StaticResource Card}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="About" Style="{StaticResource SectionHeader}"/>
                    <Label Text="UniteRev Stream Manager" Style="{StaticResource Body}" FontAttributes="Bold"/>
                    <Label Text="{Binding AppVersion, StringFormat='Version {0}'}" Style="{StaticResource Caption}"/>
                    <Label Text="Multi-stream viewer for protests and activism" Style="{StaticResource Caption}"/>
                    <Button Text="View on GitHub"
                            Style="{StaticResource SecondaryButton}"
                            Command="{Binding OpenGitHubCommand}"
                            HorizontalOptions="Start" Margin="0,4,0,0"/>

                    <!-- Status -->
                    <Label Text="{Binding StatusMessage}"
                           Style="{StaticResource Caption}"
                           TextColor="{StaticResource Success}"
                           IsVisible="{Binding StatusMessage, Converter={StaticResource StringNotEmptyConverter}}"
                           Margin="0,8,0,0"/>
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
